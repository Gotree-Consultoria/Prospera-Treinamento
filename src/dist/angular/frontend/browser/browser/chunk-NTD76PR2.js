import{f as L}from"./chunk-4WPZJNDW.js";import{a as U}from"./chunk-QH4O4DEC.js";import"./chunk-ISAQG44I.js";import{Eb as s,Fb as d,Ja as r,O as I,Qb as u,S as P,Sb as f,T as S,Tb as b,Ua as E,Y as w,Yb as D,Z as h,Za as l,ga as g,ib as y,n as _,nb as p,o as x,ob as a,oc as V,pb as o,qb as M,r as v,ub as A,vb as O,wb as c,xc as N,yc as T,z as C,zc as k}from"./chunk-REX2TJ7H.js";var m=class n{constructor(t){this.api=t}getMySubscription(){return this.api.get("/me/subscription").pipe(v(t=>this.normalize(t)),C(t=>t?.status===404?_(null):x(()=>t)))}normalize(t){if(!t)return{id:"n/a",planName:"Plano",status:"INDEFINIDO"};let e=t.subscription??t.plan??t,i=e.plan??e;return{id:String(e.id??i.id??e.uuid??i.uuid??"sub-unknown"),planName:i.name??i.planName??i.title??"Plano",description:i.description??i.details??"",startedAt:e.startedAt??e.startDate??e.createdAt??null,expiresAt:e.expiresAt??e.endDate??null,originalPrice:e.originalPrice??i.originalPrice??null,currentPrice:e.currentPrice??e.price??i.currentPrice??i.price??null,durationInDays:e.durationInDays??i.durationInDays??null,status:(e.status??"ATIVA").toString().toUpperCase(),raw:t}}static \u0275fac=function(e){return new(e||n)(P(U))};static \u0275prov=I({token:n,factory:n.\u0275fac,providedIn:"root"})};function R(n,t){n&1&&(a(0,"div",6),M(1,"span",7),a(2,"p"),s(3,"Carregando assinatura\u2026"),o()())}function F(n,t){n&1&&(a(0,"div",8)(1,"p"),s(2,"Voc\xEA ainda n\xE3o possui uma assinatura ativa."),o(),a(3,"a",9),s(4,"Ver Planos"),o()())}function X(n,t){if(n&1){let e=A();a(0,"div",10)(1,"p"),s(2),o(),a(3,"button",11),O("click",function(){w(e);let B=c();return h(B.reload())}),s(4,"Tentar novamente"),o()()}if(n&2){let e=c();r(2),d(e.error())}}function G(n,t){if(n&1&&(a(0,"p",19),s(1),o()),n&2){let e=c().ngIf;r(),d(e.description)}}function $(n,t){if(n&1&&(a(0,"div")(1,"dt"),s(2,"In\xEDcio"),o(),a(3,"dd"),s(4),u(5,"date"),o()()),n&2){let e=c().ngIf;r(4),d(f(5,1,e.startedAt,"shortDate"))}}function q(n,t){if(n&1&&(a(0,"div")(1,"dt"),s(2,"Expira em"),o(),a(3,"dd"),s(4),u(5,"date"),o()()),n&2){let e=c().ngIf;r(4),d(f(5,1,e.expiresAt,"shortDate"))}}function H(n,t){if(n&1&&(a(0,"div")(1,"dt"),s(2,"Dura\xE7\xE3o"),o(),a(3,"dd"),s(4),o()()),n&2){let e=c().ngIf,i=c();r(4),d(i.durationLabel(e.durationInDays))}}function J(n,t){if(n&1&&(a(0,"span",23),s(1),u(2,"currency"),o()),n&2){let e=c(2).ngIf;r(),d(b(2,1,e.originalPrice,"BRL","symbol","1.2-2"))}}function K(n,t){if(n&1&&(a(0,"div",20),l(1,J,3,6,"span",21),a(2,"span",22),s(3),u(4,"currency"),o()()),n&2){let e=c().ngIf,i=c();r(),p("ngIf",i.showDiscount(e)),r(2),d(b(4,2,e.currentPrice,"BRL","symbol","1.2-2"))}}function Q(n,t){if(n&1&&(a(0,"div",12)(1,"header",13)(2,"h2"),s(3),o(),a(4,"span",14),s(5),o()(),l(6,G,2,1,"p",15),a(7,"dl",16),l(8,$,6,4,"div",17)(9,q,6,4,"div",17)(10,H,5,1,"div",17),o(),l(11,K,5,7,"div",18),o()),n&2){let e=t.ngIf,i=c();r(3),d(e.planName),r(),y("data-status",e.status),r(),d(i.humanStatus(e.status)),r(),p("ngIf",e.description),r(2),p("ngIf",e.startedAt),r(),p("ngIf",e.expiresAt),r(),p("ngIf",e.durationInDays),r(),p("ngIf",e.currentPrice)}}var z=class n{service=S(m);subscription=g(void 0);loading=D(()=>this.subscription()===void 0);error=g(null);ngOnInit(){this.load()}reload(){this.load(!0)}load(t=!1){t&&(this.subscription.set(void 0),this.error.set(null)),this.service.getMySubscription().subscribe({next:e=>{this.subscription.set(e)},error:e=>{console.warn("[SubscriptionView] erro ao carregar assinatura",e),this.error.set("N\xE3o foi poss\xEDvel carregar sua assinatura agora."),this.subscription.set(null)}})}showDiscount(t){return!!t.originalPrice&&!!t.currentPrice&&t.originalPrice>t.currentPrice}durationLabel(t){return t?t>=28&&t<=31?"Mensal":t>=85&&t<=95?"Trimestral":t>=170&&t<=190?"Semestral":t>=360&&t<=370?"Anual":t===7?"Semanal":`${t} dias`:"\u2014"}humanStatus(t){if(!t)return"\u2014";let e=t.toUpperCase();switch(e){case"ACTIVE":case"ATIVA":return"Ativa";case"CANCELED":case"CANCELADA":return"Cancelada";case"EXPIRED":case"EXPIRADA":return"Expirada";case"PENDING":case"PENDENTE":return"Pendente";default:return e.charAt(0)+e.slice(1).toLowerCase()}}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=E({type:n,selectors:[["pros-subscription-view"]],decls:8,vars:4,consts:[["aria-live","polite",1,"subscription"],[1,"container"],["class","loading",4,"ngIf"],["class","empty",4,"ngIf"],["class","error",4,"ngIf"],["class","sub-card",4,"ngIf"],[1,"loading"],["aria-hidden","true",1,"spinner"],[1,"empty"],["routerLink","/planos",1,"btn","btn-primary"],[1,"error"],[1,"btn","btn-secondary",3,"click"],[1,"sub-card"],[1,"sub-header"],[1,"status"],["class","description",4,"ngIf"],[1,"meta"],[4,"ngIf"],["class","pricing",4,"ngIf"],[1,"description"],[1,"pricing"],["class","old",4,"ngIf"],[1,"current"],[1,"old"]],template:function(e,i){e&1&&(a(0,"section",0)(1,"div",1)(2,"h1"),s(3,"Minha Assinatura"),o(),l(4,R,4,0,"div",2)(5,F,5,0,"div",3)(6,X,5,1,"div",4)(7,Q,12,8,"div",5),o()()),e&2&&(r(4),p("ngIf",i.loading()),r(),p("ngIf",!i.loading()&&!i.error()&&i.subscription()===null),r(),p("ngIf",!i.loading()&&i.error()),r(),p("ngIf",!i.loading()&&i.subscription()))},dependencies:[k,V,L,T,N],styles:[".subscription[_ngcontent-%COMP%]{padding:2.5rem 0 4rem}h1[_ngcontent-%COMP%]{font-size:clamp(1.75rem,4vw,2.5rem);margin-bottom:1.5rem}.loading[_ngcontent-%COMP%], .empty[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;padding:3rem 0}.spinner[_ngcontent-%COMP%]{width:2.75rem;height:2.75rem;border-radius:50%;border:3px solid rgba(91,95,99,.25);border-top-color:var(--color-primary-500, #6a5acd);display:inline-block;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:1rem}.sub-card[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(106,90,205,.15);border-radius:16px;padding:2rem 2.25rem;box-shadow:0 12px 32px #1f242b14;max-width:720px}.sub-header[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:1rem;align-items:center;justify-content:space-between}.sub-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;font-size:1.5rem}.status[_ngcontent-%COMP%]{font-size:.65rem;letter-spacing:.14em;text-transform:uppercase;font-weight:600;padding:.4rem .7rem;border-radius:999px;background:#5b5f6326}.status[data-status=ATIVA][_ngcontent-%COMP%], .status[data-status=ACTIVE][_ngcontent-%COMP%]{background:#2eb67d2e;color:#11805a}.status[data-status=CANCELADA][_ngcontent-%COMP%], .status[data-status=CANCELED][_ngcontent-%COMP%]{background:#ff52522e;color:#b30021}.description[_ngcontent-%COMP%]{margin:.75rem 0 1.25rem;color:var(--color-text-muted, #5b5f63)}dl.meta[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:2rem;margin:0 0 1.5rem}dl.meta[_ngcontent-%COMP%]   div[_ngcontent-%COMP%]{min-width:120px}dl.meta[_ngcontent-%COMP%]   dt[_ngcontent-%COMP%]{font-size:.7rem;letter-spacing:.12em;text-transform:uppercase;font-weight:600;margin-bottom:.25rem;color:#555}dl.meta[_ngcontent-%COMP%]   dd[_ngcontent-%COMP%]{margin:0;font-weight:500}.pricing[_ngcontent-%COMP%]{display:flex;align-items:baseline;gap:.75rem;font-weight:600}.pricing[_ngcontent-%COMP%]   .old[_ngcontent-%COMP%]{text-decoration:line-through;color:#888;font-weight:400}.pricing[_ngcontent-%COMP%]   .current[_ngcontent-%COMP%]{font-size:1.5rem;color:var(--color-primary-600, #5a4bcf)}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})};export{z as SubscriptionViewComponent};
