import{a as L}from"./chunk-SEZHNA43.js";import{a as U}from"./chunk-JWVYCWG5.js";import{c as N,f as V,i as B}from"./chunk-4WPZJNDW.js";import"./chunk-QH4O4DEC.js";import"./chunk-ISAQG44I.js";import{Ab as E,Bb as O,Cb as k,Eb as a,Fa as M,Fb as p,Ja as l,Qb as C,Sb as P,T as h,Ua as y,Ub as I,Y as f,Z as u,Za as m,Zb as T,a as x,b as v,ga as g,nb as c,nc as A,ob as i,oc as D,pb as t,qb as w,ub as b,vb as _,wb as s,xc as F,zc as z}from"./chunk-REX2TJ7H.js";function Y(r,n){if(r&1){let e=b();i(0,"div",8)(1,"div",9)(2,"a",10),a(3,"\u2190 Voltar"),t(),i(4,"h1",11),a(5),t(),i(6,"span",12),a(7),t()(),i(8,"div",13)(9,"button",14),_("click",function(){f(e);let d=s(2);return u(d.publish())}),a(10),t(),i(11,"label",15)(12,"span"),a(13,"Upload PDF"),t(),i(14,"input",16),_("change",function(d){return f(e),s(2).onPdfSelected(d.target.files[0]),d.target.value="",u(d.stopPropagation())}),t()(),i(15,"label",15)(16,"span"),a(17,"Upload Capa"),t(),i(18,"input",17),_("change",function(d){return f(e),s(2).onCoverSelected(d.target.files[0]),d.target.value="",u(d.stopPropagation())}),t()()()()}if(r&2){let e=n.ngIf,o=s(2);l(5),p(e.title),l(),k("published",(e.publicationStatus||"").toLowerCase()==="published"),l(),p(e.publicationStatus||"\u2014"),l(2),c("disabled",o.publishing()||(e.publicationStatus||"").toLowerCase()==="published"),l(),p((e.publicationStatus||"").toLowerCase()==="published"?"Publicado":"Publicar")}}function j(r,n){r&1&&(i(0,"div",18),a(1,"Carregando..."),t())}function q(r,n){if(r&1&&(i(0,"div",19),a(1),t()),r&2){let e=s(2);l(),p(e.error())}}function K(r,n){if(r&1&&(i(0,"div",20),w(1,"div",21),t()),r&2){let e=s(2);l(),O("width",e.uploadProgress()||0,"%")}}function W(r,n){if(r&1){let e=b();i(0,"img",39),_("error",function(){f(e);let d=s(4);return u(d.coverBroken.set(!0))}),t()}if(r&2){let e=s().ngIf;c("src",e,M)}}function G(r,n){r&1&&(i(0,"div",40),a(1,"Sem capa"),t())}function J(r,n){r&1&&(i(0,"figcaption",41),a(1,"PDF"),t())}function Q(r,n){if(r&1&&(i(0,"figure",35),m(1,W,1,1,"img",36)(2,G,2,0,"div",37)(3,J,2,0,"figcaption",38),t()),r&2){let e=s().ngIf,o=s(2);l(),c("ngIf",!o.coverBroken()),l(),c("ngIf",o.coverBroken()),l(),c("ngIf",o.trainingHasPdf(e))}}function X(r,n){if(r&1&&(i(0,"a",50),a(1,"Abrir PDF"),t()),r&2){let e=n.ngIf;c("href",e,M)}}function Z(r,n){if(r&1&&(i(0,"div",48),m(1,X,2,1,"a",49),t()),r&2){let e=s(2).ngIf,o=s(2);l(),c("ngIf",o.buildEbookFileUrl(o.extractPdfFileName(e)))}}function $(r,n){if(r&1&&(i(0,"section",31)(1,"h2",32),a(2,"E-book"),t(),i(3,"div",42)(4,"div",43)(5,"span",44),a(6,"Arquivo"),t(),i(7,"span",45),a(8),t()(),i(9,"div",43)(10,"span",44),a(11,"P\xE1ginas"),t(),i(12,"span",46),a(13),t()(),i(14,"div",43)(15,"span",44),a(16,"Upload"),t(),i(17,"span",46),a(18),C(19,"date"),t()()(),m(20,Z,2,1,"div",47),t()),r&2){let e=n.ngIf,o=s().ngIf,d=s(2);l(8),p(e.filePath||d.extractPdfFileName(o)||"\u2014"),l(5),p(e.totalPages||"\u2014"),l(5),p(P(19,4,e.fileUploadedAt,"short")),l(2),c("ngIf",d.trainingHasPdf(o))}}function ee(r,n){if(r&1){let e=b();i(0,"tr")(1,"td",53),a(2),t(),i(3,"td",54),a(4),t(),i(5,"td",55),a(6),t(),i(7,"td",56),a(8),t(),i(9,"td",57)(10,"button",58),_("click",function(){let d=f(e).$implicit,S=s(2).ngIf,H=s(2);return u(H.unlinkSector(d.sectorId,S.id))}),a(11,"Remover"),t()()()}if(r&2){let e=n.$implicit,o=s(4);l(2),p(e.sectorId),l(2),p(o.sectorName(e.sectorId)),l(2),p(e.trainingType||"\u2014"),l(2),p(e.legalBasis||"\u2014")}}function te(r,n){if(r&1&&(i(0,"section",31)(1,"h2",32),a(2,"Setores Vinculados"),t(),i(3,"table",51)(4,"thead")(5,"tr")(6,"th"),a(7,"ID"),t(),i(8,"th"),a(9,"Nome do Setor"),t(),i(10,"th"),a(11,"Tipo"),t(),i(12,"th"),a(13,"Base Legal"),t(),i(14,"th"),a(15,"A\xE7\xF5es"),t()()(),i(16,"tbody"),m(17,ee,12,4,"tr",52),t()()()),r&2){let e=s().ngIf;l(17),c("ngForOf",e.sectorAssignments)}}function ne(r,n){if(r&1&&(i(0,"div",22)(1,"section",23)(2,"div",24),m(3,Q,4,3,"figure",25),i(4,"div",26)(5,"div",27)(6,"label"),a(7,"ID"),t(),i(8,"div",28),a(9),t()(),i(10,"div",27)(11,"label"),a(12,"Autor"),t(),i(13,"div",29),a(14),t()(),i(15,"div",27)(16,"label"),a(17,"Tipo"),t(),i(18,"div",29),a(19),t()(),i(20,"div",27)(21,"label"),a(22,"Status"),t(),i(23,"div",29)(24,"span",30),a(25),t()()(),i(26,"div",27)(27,"label"),a(28,"Criado"),t(),i(29,"div",29),a(30),C(31,"date"),t()(),i(32,"div",27)(33,"label"),a(34,"Atualizado"),t(),i(35,"div",29),a(36),C(37,"date"),t()()()()(),i(38,"section",31)(39,"h2",32),a(40,"Descri\xE7\xE3o"),t(),i(41,"p",33),a(42),t()(),m(43,$,21,7,"section",34)(44,te,18,1,"section",34),t()),r&2){let e=n.ngIf;l(3),c("ngIf",e.coverImageUrl),l(6),p(e.id),l(5),p(e.author||"\u2014"),l(5),p(e.entityType||"\u2014"),l(5),k("badge-active",(e.publicationStatus||"").toLowerCase()==="published")("badge-inactive",(e.publicationStatus||"").toLowerCase()!=="published"),l(),p(e.publicationStatus||"\u2014"),l(5),p(P(31,14,e.createdAt,"short")),l(6),p(P(37,17,e.updatedAt,"short")),l(6),p(e.description||"\u2014"),l(),c("ngIf",e.entityType==="EBOOK"&&e.ebookDetails),l(),c("ngIf",e.sectorAssignments==null?null:e.sectorAssignments.length)}}function ie(r,n){if(r&1){let e=b();i(0,"div",2),_("click",function(){f(e);let d=s();return u(d.closeFilePickers())}),m(1,Y,19,6,"div",3)(2,j,2,0,"div",4)(3,q,2,1,"div",5)(4,K,2,2,"div",6)(5,ne,45,20,"div",7),t()}if(r&2){let e=s();l(),c("ngIf",e.training()),l(),c("ngIf",e.loading()),l(),c("ngIf",e.error()),l(),c("ngIf",e.uploadProgress()!==null),l(),c("ngIf",!e.loading()&&e.training())}}function re(r,n){r&1&&(i(0,"p",19),a(1,"Acesso negado."),t())}var R=class r{route=h(N);admin=h(L);auth=h(U);training=g(null);loading=g(!0);error=g(null);publishing=g(!1);uploadProgress=g(null);coverBroken=g(!1);sectors=g([]);isSystemAdmin=()=>this.auth.hasRole("SYSTEM_ADMIN");constructor(){T(()=>{let n=this.route.snapshot.paramMap.get("id");n&&this.fetch(n)}),this.loadSectors()}fetch(n){this.loading.set(!0),this.error.set(null),this.admin.getTrainingById(n).subscribe({next:e=>{e&&!e.publicationStatus&&e.status&&(e=v(x({},e),{publicationStatus:e.status})),this.training.set(e)},error:e=>this.error.set(e?.message||"Erro ao carregar treinamento"),complete:()=>this.loading.set(!1)})}publish(){let n=this.training();!n||(n.publicationStatus||"").toLowerCase()==="published"||confirm(`Publicar '${n.title}'?`)&&(this.publishing.set(!0),this.admin.publishTraining(n.id).subscribe({next:()=>this.training.update(e=>e&&v(x({},e),{publicationStatus:"PUBLISHED"})),error:e=>this.error.set(e?.message||"Falha ao publicar"),complete:()=>this.publishing.set(!1)}))}onPdfSelected(n){let e=this.training();!e||!n||(this.uploadProgress.set(0),this.admin.uploadEbookFileWithProgress(e.id,n).subscribe({next:o=>{o.type==="progress"&&this.uploadProgress.set(o.progress??0)},error:o=>{this.error.set(o?.message||"Falha upload PDF"),this.uploadProgress.set(null)},complete:()=>{this.uploadProgress.set(100),setTimeout(()=>this.uploadProgress.set(null),1200)}}))}onCoverSelected(n){let e=this.training();!e||!n||(this.uploadProgress.set(0),this.admin.uploadTrainingCoverImage(e.id,n).subscribe({next:o=>{o.type==="progress"&&this.uploadProgress.set(o.progress??0)},error:o=>{this.error.set(o?.message||"Falha upload capa"),this.uploadProgress.set(null)},complete:()=>{this.uploadProgress.set(100),setTimeout(()=>this.uploadProgress.set(null),1e3)}}))}trainingHasPdf(n){return this.admin.trainingHasPdf(n)}extractPdfFileName(n){return this.admin.extractPdfFileName(n)}buildEbookFileUrl(n){return this.admin.buildEbookFileUrl(n)}unlinkSector(n,e){!n||!e||confirm("Remover v\xEDnculo com setor?")&&this.admin.unlinkTrainingSector(e,n).subscribe({next:()=>this.training.update(o=>o&&v(x({},o),{sectorAssignments:(o.sectorAssignments||[]).filter(d=>d.sectorId!==n)})),error:o=>this.error.set(o?.message||"Falha ao desvincular setor")})}loadSectors(){this.admin.getSectors().subscribe({next:n=>this.sectors.set(n||[]),error:()=>{}})}sectorName(n){return n?this.sectors().find(o=>o.id===n)?.name||n:"\u2014"}closeFilePickers(){}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=y({type:r,selectors:[["app-admin-training-detail"]],decls:3,vars:2,consts:[["noAccess",""],["class","training-detail-page",3,"click",4,"ngIf","ngIfElse"],[1,"training-detail-page",3,"click"],["class","header-row",4,"ngIf"],["class","loading skeleton",4,"ngIf"],["class","error",4,"ngIf"],["class","progress-bar top",4,"ngIf"],["class","cards",4,"ngIf"],[1,"header-row"],[1,"title-block"],["routerLink","/admin",1,"back-link"],[1,"title"],[1,"status-badge"],[1,"action-bar"],["type","button",1,"btn","btn--primary",3,"click","disabled"],[1,"btn","btn--outline","file-btn"],["type","file","accept","application/pdf","hidden","",3,"change"],["type","file","accept","image/*","hidden","",3,"change"],[1,"loading","skeleton"],[1,"error"],[1,"progress-bar","top"],[1,"bar"],[1,"cards"],[1,"card","meta-card"],[1,"cover-meta"],["class","cover",4,"ngIf"],[1,"meta-grid"],[1,"field"],[1,"value","mono"],[1,"value"],[1,"badge"],[1,"card"],[1,"card-title"],[1,"description"],["class","card",4,"ngIf"],[1,"cover"],["alt","Capa",3,"src","error",4,"ngIf"],["class","cover-fallback",4,"ngIf"],["class","pdf-flag",4,"ngIf"],["alt","Capa",3,"error","src"],[1,"cover-fallback"],[1,"pdf-flag"],[1,"kv-grid"],[1,"kv-item"],[1,"k"],[1,"v","mono"],[1,"v"],["class","ebook-actions",4,"ngIf"],[1,"ebook-actions"],["class","btn btn--ghost","target","_blank","rel","noopener",3,"href",4,"ngIf"],["target","_blank","rel","noopener",1,"btn","btn--ghost",3,"href"],["aria-label","Setores vinculados",1,"table","mini"],[4,"ngFor","ngForOf"],["data-label","ID",1,"mono"],["data-label","Nome do Setor"],["data-label","Tipo"],["data-label","Base Legal"],["data-label","A\xE7\xF5es",1,"actions-col"],["type","button",1,"btn","btn--ghost","btn-xs",3,"click"]],template:function(e,o){if(e&1&&m(0,ie,6,5,"div",1)(1,re,2,0,"ng-template",null,0,I),e&2){let d=E(2);c("ngIf",o.isSystemAdmin())("ngIfElse",d)}},dependencies:[z,A,D,B,V,F],styles:["[_nghost-%COMP%]{display:block;padding:1.5rem clamp(.75rem,2vw,1.5rem) 3rem}.training-detail-page[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.25rem}.header-row[_ngcontent-%COMP%]{display:flex;justify-content:space-between;gap:1.25rem;flex-wrap:wrap;align-items:flex-start}.title-block[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.4rem;min-width:260px}.back-link[_ngcontent-%COMP%]{text-decoration:none;font-size:.7rem;color:#4f46e5;font-weight:600}.back-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.title[_ngcontent-%COMP%]{margin:0;font-size:1.4rem;line-height:1.1;font-weight:600;letter-spacing:-.5px;color:#1e293b}.status-badge[_ngcontent-%COMP%]{display:inline-block;width:fit-content;font-size:.6rem;font-weight:600;letter-spacing:.05em;text-transform:uppercase;padding:.3rem .55rem;border-radius:6px;background:#e2e8f0;color:#334155}.status-badge.published[_ngcontent-%COMP%]{background:linear-gradient(90deg,#22c55e,#16a34a);color:#fff}.action-bar[_ngcontent-%COMP%]{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}.loading.skeleton[_ngcontent-%COMP%]{opacity:.75}.error[_ngcontent-%COMP%]{font-size:.8rem;color:#b91c1c}.cards[_ngcontent-%COMP%]{display:grid;gap:1rem;grid-template-columns:1fr}.card[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:14px;padding:1rem 1.1rem 1.1rem;position:relative;box-shadow:0 4px 14px -6px #00000014;display:flex;flex-direction:column;gap:.85rem;animation:_ngcontent-%COMP%_fadeIn .25s ease}.card-title[_ngcontent-%COMP%]{margin:0;font-size:.85rem;letter-spacing:.05em;font-weight:700;text-transform:uppercase;color:#334155}.meta-card[_ngcontent-%COMP%]{padding-bottom:.9rem}.cover-meta[_ngcontent-%COMP%]{display:flex;gap:1.25rem;flex-wrap:wrap;align-items:stretch}.cover[_ngcontent-%COMP%]{margin:0;width:140px}.cover[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:140px;height:180px;object-fit:cover;border:1px solid #e2e8f0;border-radius:10px;box-shadow:0 2px 6px -2px #00000026;background:#fff}.cover-fallback[_ngcontent-%COMP%]{width:140px;height:180px;border:1px dashed #cbd5e1;display:flex;align-items:center;justify-content:center;font-size:.65rem;border-radius:10px;color:#64748b;background:#f8fafc}.pdf-flag[_ngcontent-%COMP%]{margin-top:.5rem;text-align:center;font-size:.55rem;letter-spacing:.05em;background:#eef2ff;border:1px solid #c7d2fe;color:#3730a3;padding:.18rem .45rem;border-radius:6px;font-weight:600}.meta-grid[_ngcontent-%COMP%]{display:grid;flex:1;gap:.75rem;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));align-content:start}.meta-grid[_ngcontent-%COMP%]   .field[_ngcontent-%COMP%]{background:#fff;border:1px solid #e2e8f0;border-radius:10px;padding:.55rem .65rem .65rem;display:flex;flex-direction:column;gap:.35rem;position:relative;box-shadow:0 1px 2px #0000000d}.meta-grid[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.55rem;letter-spacing:.05em;text-transform:uppercase;color:#64748b;font-weight:700}.value[_ngcontent-%COMP%]{font-size:.72rem;font-weight:500;color:#1e293b;word-break:break-word}.mono[_ngcontent-%COMP%]{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;font-size:.62rem}.description[_ngcontent-%COMP%]{font-size:.7rem;color:#334155;line-height:1.4;margin:0;white-space:pre-line}.kv-grid[_ngcontent-%COMP%]{display:grid;gap:.6rem;grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}.kv-item[_ngcontent-%COMP%]{background:#f8fafc;border:1px solid #e2e8f0;padding:.5rem .6rem;border-radius:8px;font-size:.6rem;display:flex;flex-direction:column;gap:.3rem}.kv-item[_ngcontent-%COMP%]   .k[_ngcontent-%COMP%]{font-size:.55rem;letter-spacing:.05em;text-transform:uppercase;color:#64748b;font-weight:600}.kv-item[_ngcontent-%COMP%]   .v[_ngcontent-%COMP%]{font-size:.7rem;font-weight:500;color:#1e293b}.ebook-actions[_ngcontent-%COMP%]{display:flex;gap:.5rem;flex-wrap:wrap}.table[_ngcontent-%COMP%]{width:100%;border-collapse:collapse;font-size:.65rem}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:left;font-size:.55rem;letter-spacing:.05em;text-transform:uppercase;font-weight:600;padding:.45rem .5rem;background:#f1f5f9;color:#334155}.table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{padding:.45rem .5rem;border-top:1px solid #e2e8f0}.actions-col[_ngcontent-%COMP%]{text-align:right}.btn[_ngcontent-%COMP%]{--btn-bg:#f1f5f9;--btn-border:#cbd5e1;--btn-color:#0f172a;--btn-bg-hover:#e2e8f0;--btn-shadow:0 1px 2px rgba(0,0,0,.05);font-size:.66rem;font-weight:600;letter-spacing:.4px;padding:.55rem .9rem;border-radius:9px;border:1px solid var(--btn-border);background:var(--btn-bg);color:var(--btn-color);cursor:pointer;transition:.18s cubic-bezier(.4,0,.2,1);display:inline-flex;align-items:center;gap:.45rem;position:relative;box-shadow:var(--btn-shadow)}.btn-xs[_ngcontent-%COMP%]{padding:.35rem .55rem;font-size:.55rem;border-radius:7px}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed}.btn[_ngcontent-%COMP%]:not(:disabled):hover{background:var(--btn-bg-hover);transform:translateY(-1px);box-shadow:0 4px 14px -4px #00000026}.btn[_ngcontent-%COMP%]:not(:disabled):active{transform:translateY(0);box-shadow:0 2px 8px -4px #0003}.btn--primary[_ngcontent-%COMP%]{--btn-bg:#6366f1;--btn-bg-hover:#4f46e5;--btn-border:#6366f1;--btn-color:#fff}.btn--outline[_ngcontent-%COMP%]{--btn-bg:#ffffff;--btn-bg-hover:#f8fafc;--btn-border:#94a3b8}.btn--ghost[_ngcontent-%COMP%]{background:transparent;border:1px solid transparent;box-shadow:none;padding:.45rem .65rem}.btn--ghost[_ngcontent-%COMP%]:hover{background:#f1f5f9}.file-btn[_ngcontent-%COMP%]{cursor:pointer;overflow:hidden}.badge[_ngcontent-%COMP%]{padding:.25rem .55rem;font-size:.55rem;border-radius:14px;font-weight:600;letter-spacing:.5px;background:#e2e8f0;color:#334155;position:relative;overflow:hidden}.badge-active[_ngcontent-%COMP%]{background:linear-gradient(90deg,#22c55e,#16a34a);color:#fff}.badge-inactive[_ngcontent-%COMP%]{background:linear-gradient(90deg,#f87171,#dc2626);color:#fff}.progress-bar.top[_ngcontent-%COMP%]{position:relative;height:5px;background:#e2e8f0;border-radius:4px;overflow:hidden;margin-top:-.5rem}.progress-bar[_ngcontent-%COMP%]   .bar[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(90deg,#6366f1,#818cf8);transition:width .25s}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}@media (min-width: 900px){.cards[_ngcontent-%COMP%]{grid-template-columns:repeat(2,minmax(0,1fr))}.meta-card[_ngcontent-%COMP%]{grid-column:1/-1}}"]})};export{R as AdminTrainingDetailComponent};
