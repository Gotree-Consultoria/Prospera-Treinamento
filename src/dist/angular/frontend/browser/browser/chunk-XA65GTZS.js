import{a as y}from"./chunk-QH4O4DEC.js";import{B as m,C as p,J as u,O as d,S as f,m as c,n as l,r as o,y as g,z as s}from"./chunk-REX2TJ7H.js";var A=class n{constructor(t){this.api=t}loadCatalog(){let t=l([]);return this.fetchPublicCatalogAll().pipe(o(r=>this.mergeDistinct(r)),s(r=>(console.warn("[CatalogService] falha em /public/catalog, aplicando fallback composto.",r),t)))}loadSectors(){return c(["/api/public/catalog/sectors","/public/catalog/sectors"]).pipe(u(r=>this.api.get(r).pipe(o(a=>(Array.isArray(a)?a:Array.isArray(a?.items)?a.items:Array.isArray(a?.data)?a.data:[]).filter(Boolean).map(i=>this.normalizeSector(i))),s(()=>l([])))),g(r=>r.length>0),p(1),m([]))}fetchPublicCatalogAll(){return this.api.get("/public/catalog").pipe(o(t=>(Array.isArray(t)?t:Array.isArray(t?.items)?t.items:Array.isArray(t?.data)?t.data:[]).map(a=>this.toCatalogItem(a,this.normalizeFormat(a?.format??a?.type??a?.trainingType)??"EBOOK",a.coverImageUrl??a.imageUrl??null))))}mergeDistinct(t){let r=new Map;for(let a of t){let e=`${a.format}::${a.id}`;if(!r.has(e))r.set(e,a);else{let i=r.get(e);(a.description?.length??0)>(i.description?.length??0)&&r.set(e,a)}}return Array.from(r.values())}toCatalogItem(t,r,a){let e=Array.isArray(t?.sectors)?t.sectors:Array.isArray(t?.assignedSectors)?t.assignedSectors:["global"];return{id:String(t?.id??t?.uuid??t?.code??`item-${Math.random().toString(36).slice(2,9)}`),title:t?.title??t?.name??"Item",description:t?.description??t?.shortDescription??"",format:this.normalizeFormat(t?.format??t?.type??t?.trainingType)??r,sectors:e.map(i=>typeof i=="string"?i:i?.id??i?.code??"global"),coverImageUrl:a||void 0,data:t}}normalizeFormat(t){if(!t)return null;let r=t.toUpperCase();return r.includes("EBOOK")?"EBOOK":r.includes("RECORDED")||r.includes("GRAV")?"RECORDED_COURSE":r.includes("LIVE")||r.includes("AO_VIVO")?"LIVE_TRAINING":r.includes("PACKAGE")?"PACKAGE":null}normalizeSector(t){return{id:String(t?.id??t?.uuid??t?.code??t?.slug??"global"),name:t?.name??t?.title??t?.label??"Setor"}}static \u0275fac=function(r){return new(r||n)(f(y))};static \u0275prov=d({token:n,factory:n.\u0275fac,providedIn:"root"})};export{A as a};
